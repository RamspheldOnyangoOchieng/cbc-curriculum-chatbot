name: Render Keep-Alive & Health Check

on:
  schedule:
    # Runs every 14 minutes (Render free tier sleeps after 15 mins of inactivity)
    - cron: '*/14 * * * *'
  workflow_dispatch: # Allows you to manually trigger this from the "Actions" tab

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Backend
        run: |
          URL="https://cbc-curriculum-chatbot.onrender.com"
          echo "Pinging $URL..."
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" "$URL")
          echo "Response Status: $STATUS"
          if [ "$STATUS" -eq 200 ] || [ "$STATUS" -eq 301 ] || [ "$STATUS" -eq 302 ]; then
            echo "✅ Backend is AWAKE and healthy."
          else
            echo "⚠️ Backend returned $STATUS. It might be sleeping, starting up, or failing."
            # Optional: Add a second ping after 30s to help cold starts
            sleep 30
            curl -s "$URL" > /dev/null
          fi
